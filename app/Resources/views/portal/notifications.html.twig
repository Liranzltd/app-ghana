{% extends 'base-portal.html.twig' %}

{% block pagetitle %}Notifications{% endblock %}

{% block crumbtitle %}Your messages {% endblock %}

{% block body %}
<div class="panel panel-widget container">
  <div class="panel-title">
    Notifications <span class="label label-warning">{{ notifications|length }}</span>

  </div>
  <div class="panel-body table-responsive">
    <table class="table">
      <thead>
        <tr>
          <td>#</td>
          <td>Subject</td>
          <td>Date</td>
        </tr>
      </thead>
      <tbody>
        {% for notification in notifications %}
          <tr>
            <td>{{ loop.index }}</td>
            <td>{% if notification.isRead == 0 %}<strong>{% endif %}<a class="msgModal" href="#" id="notification_{{ loop.index }}" data-title="{{ notification.title }}" data-id="{{ notification.id }}" data-message="{{ notification.message }}">{{ notification.title }}</a>{% if notification.isRead == 0 %}</  strong>{% endif %}</td>
            <td>{{ notification.createdAt|date('d/m/Y g:iA') }}</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
<div class="modal fade" tabindex="-1" role="dialog" id="messagemodal">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title"></h4>
      </div>
      <div class="modal-body">

      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-primary" data-dismiss="modal">Close</button>
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->
{% endblock %}

{% block javascripts %}
  {{ parent() }}
  <script>
    $('.msgModal').on('click',function(e)
    {
      e.preventDefault();

      $.ajax({
        url: '{{ path('portal-notification-read') }}',
        data: { notification: $(this).data('id')}
      });
      $('.modal-title').html($(this).data('title'));
      $('.modal-body').html($(this).data('message'));
      $('#messagemodal').modal();
    })
  </script>
{% endblock %}
