{% extends 'base-inner.html.twig' %}

{% block pagetitle %}APP Account Activation{% endblock %}

{% block title %}APP Account Activation{% endblock %}
{% block leadingtext %}{{ company.name }}{% endblock %}

{% block body %}
<div class="container">
    <div class="row">
      <div class="col-md-4 col-md-offset-4">
        <select name="tier" id="tier">
          {% for tier in tiers %}
            {% if tier.name != "Bronze" %}
            <option {{ tier.id == company.tier.id ? "selected" : "" }} data-tier="{{ tier.name }}" data-subscriptionFee="{{ tier.subscriptionFee }}" data-id="{{ tier.id }}">{{ tier.name ~ ' for ' ~ tier.membershipCategory ~ ' @GHS '~ tier.subscriptionFee }}</option>
            {% endif %}
          {% endfor %}
        </select>
      </div>
    </div>
    <div class="row">
        <div class="col-md-12">
          <!-- <div class="pb40"><a href="#"><strong class="author-name" id="promo">Click here if you have a promo code</strong></a><br/></div> -->
          <div class="uou-tabs vertical">
            <ul class="tabs">
            {% for mode in modes %}
              <li class="{{ loop.index == 1 ? 'active' : ''}}"><a href="#uou-tab-{{ loop.index }}v">{{ mode.name }}</a></li>
            {% endfor %}
            </ul>
            <div class="content">
              {% for mode in modes %}
              <div class="pt0 {{ loop.index == 1 ? 'active' : ''}}" id="uou-tab-{{ loop.index }}v">
                <h3>{{ mode.name }}</h3>
                <h6>Your payment reference is: {{ company.paymentReference }}</h6>

                {{ mode.instructions|raw }}
              </div>
              {% endfor %}
            </div>
          </div>
          <!-- end .uou-tabs -->
        </div><!-- /.col-md-12 -->
    </div><!-- /.row -->
</div><!-- /.container -->
{% endblock %}
{% block stylesheets %}
  {{ parent() }}
  <link rel="stylesheet" type="text/css" href="{{ asset('bundles/app/css/sweetalert2.min.css')}}">
  <style>
    .swal2-modal .swal2-styled {
        padding: 0 40px;
      }
  </style>
  {% endblock %}
{% block javascripts %}
  {{ parent() }}
  <script src="{{ asset('bundles/app/js/sweetalert2.min.js')}}"></script>
  <script>
    function checkPayment()
    {
      $.ajax({
          url: '{{ path('check-payment') }}',
          data: { ref: '{{ company.paymentReference }}' },
          success: function(response)
          {
            if(response.status == 'paid')
            {
              window.location = '{{ path('edit-company',{'slug': company.slug}) }}';
            }
          },
        complete: function() {
          // schedule the next request *only* when the current one is complete:
          setTimeout(checkPayment, 10000);
        }
      });
    }
    $(function()
    {
      setTimeout(checkPayment, 10000);

      $('#hubtel').attr('href','{{ hubtel_link }}')

      $('#promo').on('click',function()
      {
        swal({
          title: 'Submit promo code',
          input: 'text',
          showCancelButton: true,
          confirmButtonText: 'Submit',
          showLoaderOnConfirm: true,
          preConfirm: function (text) {
            return new Promise(function (resolve, reject) {
              $.ajax({
                url:  '{{ path('apply-promo-code') }}',
                data: { code: text, cid: {{ company.id }} },
                success:  function(response)
                {
                  if(response.status == 200)
                  {
                    resolve(response.msg)
                  }
                  else
                  {
                    reject(response.msg)
                  }
                }
              });
            })
          },
          allowOutsideClick: false
          }).then(function (msg) {
          swal({
            type: 'success',
            title: 'Promo Code is Valid',
            html: msg
          })
          });
      });

      $('#tier').on('change',function()
      {
        var tierId = $(this).find(':selected').attr('data-id');
        var companyId = '{{ company.id }}'
        swal({
          title: 'Change subscription tier',
          showCancelButton: true,
          text: 'Would you like to change to ' + $(this).find(':selected').attr('data-tier') + '? Your new subscription fee will be ' + $(this).find(':selected').attr('data-subscriptionFee'),
          confirmButtonText: 'Confirm',
          showLoaderOnConfirm: true,
          preConfirm: function () {
            return new Promise(function (resolve, reject) {
              $.ajax({
                url:  '{{ path('change-tier') }}',
                data: { tier: tierId, company: companyId },
                success:  function(response)
                {
                  if(response.status == 200)
                  {
                    resolve(response.message)
                  }
                  else
                  {
                    reject(response.message)
                  }
                }
              });
            })
          },
          allowOutsideClick: false
          }).then(function (msg) {
          swal({
            type: 'success',
            title: 'Tier Updated',
            html: msg
          })
          });
      });
    });
  </script>
{% endblock %}
