{% extends 'base-portal.html.twig' %}

{% block pagetitle %}Respond to request{% endblock %}
{% block crumbtitle %}Respond to procurement request {% endblock %}

{% block body %}
<div class="container">
  <div class="row">
    <div class="col-md-12">
      <h6 class="news-section-title pt0">Submit response to {{ request.name }}</h6>
      <form name="submit-response" action="{{ path('save-supplier-response') }}" enctype="multipart/form-data" method="post">
        <div class="form-group">
          <label>Please describe your bid in detail</label>
          <textarea id="supplier_remarks" name="supplierRemarks" required="required" class="form-control"></textarea>
            <script type="text/javascript">
              var CKEDITOR_BASEPATH = "/bundles/ivoryckeditor/";
            </script>
            <script type="text/javascript" src="{{ asset('/bundles/ivoryckeditor/ckeditor.js') }}"></script>
            <script type="text/javascript">
              if (CKEDITOR.instances["supplier_remarks"]) { CKEDITOR.instances["supplier_remarks"].destroy(true); delete CKEDITOR.instances["supplier_remarks"]; }
              CKEDITOR.replace("supplier_remarks", {"toolbar":[["Cut","Copy","Paste","PasteText","PasteFromWord","-","Undo","Redo"],["Scayt"],["Link","Unlink","Anchor"],["Image","Table","HorizontalRule","SpecialChar"],["Maximize"],["Source"],"\/",["Bold","Italic","Strike","-","RemoveFormat"],["NumberedList","BulletedList","-","Outdent","Indent","-","Blockquote"],["Styles","Format","About"]],"uiColor":"#ffffff","language":"en"});
            </script>
        </div>
        <div class="form-group pt10">
          <label>Select company responding to bid</label>
          <select class="form-control" name="company">
            {% for company in member.companies %}
            <option value="{{ company.id }}" {{ company.subscriptionStatus == 'Expired' or company.subscriptionStatus == 'New' ? 'disabled' : '' }}>{{ company.name }} - {{ company.subscriptionStatus }}</option>
            {% endfor %}
          </select>
        </div>
        <div class="row">
         <div class="col-lg-12" id="docs">
             <h5>Documents</h5>
             <div class="row">
               <div class="col-lg-6">
                 <div class="form-group">
                     <label>Document name or title</label>
                     <input type="text" name="docs[filename][]" class="form-control">
                 </div>
               </div>
               <div class="col-lg-4">
                 <div class="form-group">
                     <label>Attach file</label>
                     <input type="file" id="FileAttachment" class="upload" name="docs[FileAttachment][]">
                     <input type="text" class="fileuploadurl" readonly placeholder="Maximum file size is 32MB" name="docs[fileuploadurl][]">
                 </div>
               </div>
             </div>
           </div>
        </div>
        <div class="row">
          <div class="col-lg-12">
           <button type="button" class="btn btn-wd btn-danger btn-xs" id="add-upload">
                <span class="btn-label">
                    <i class="fas fa-plus"></i>
                </span>
                Add Document
            </button>
          </div>
        </div>
        <br/>
        <div class="form-group pt10">
          <input type="hidden" value="{{ request.id }}" name="request" />
          <input type="submit" class="btn mb20 btn-small btn-transparent-primary" value="Submit Response" {{ member.companies|length == 1 and member.companies|first.subscriptionStatus == 'Expired' ? 'disabled' : '' }}>
        </div>
      </form>
    </div>
  </div>
</div>
{% endblock %}

{% block stylesheets %}
{{ parent() }}

{% endblock %}

{% block javascripts %}
  {{ parent() }}
  <script>
    var cnt = 0;
    $(".upload").on('change',function() {
      $(this).parent().next().val(this.value.replace(/C:\\fakepath\\/i, ''));
    });
    $('#add-upload').on('click',function(e)
    {
      cnt++;
      e.preventDefault();
      var html='<div class="row doc-row" id="row'+cnt+'">'+
        '<div class="col-lg-6">'+
        '  <div class="form-group">'+
        '    <label>Document name or title</label>'+
        '    <input type="text" name="docs[filename][]" class="form-control">'+
        '  </div>'+
        '</div>'+
        '<div class="col-lg-4">'+
        '  <div class="form-group">'+
      '      <label>Attach file</label>'+
      '       <input type="file" id="FileAttachment" class="upload" name="docs[FileAttachment][]">'+
      '       <input type="text" class="fileuploadurl" readonly placeholder="Maximum file size is 32MB" name="docs[fileuploadurl][]">'+
      '    </div>'+
      '</div>'+
      '<div class="col-lg-2">'+
      '  <button class="btn btn-xs btn-fill delete" data-id="'+cnt+'" id="delete-'+cnt+'"><i class="far fa-trash-alt"></i></button>'+
      '</div>'+
      '</div>';
      $('#docs').append(html);
      componentHandler.upgradeDom();
    });
    $(document).on('click','.delete',function(e)
    {
      e.preventDefault();
      $('#row'+$(this).data('id')).remove();
    });
  </script>
{% endblock %}
