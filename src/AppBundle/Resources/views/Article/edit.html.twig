{#

This file is part of the Sonata package.

(c) Thomas Rabaix <thomas.rabaix@sonata-project.org>

For the full copyright and license information, please view the LICENSE
file that was distributed with this source code.

#}

{% extends 'SonataAdminBundle:CRUD:base_edit.html.twig' %}

{% block javascripts %}
    {{ parent() }}
    <script src="{{ asset('bundles/app/js/croppic.min.js') }}"></script>

    <script>
        $(function()
        {
          var $select = $("#{{ admin.uniqId }}_media_type");
          {% if object.id > 1 and object.media != '' or object.media != 'c' %}
            $('#{{ admin.uniqId }}_caption').val();
          {% endif %}
          if($select.val() == 'Photo')
          {
              $('#cropContainerModal').toggle();
              $('#{{ admin.uniqId }}_media').hide();
          }
          $select.on("change", function(e)
          {
            var $this = $(this);
            if($this.val() == 'Photo')
            {
              $('#{{ admin.uniqId }}_media').hide();
              $('#cropContainerModal').show();
            }
            else
            {
              $('#{{ admin.uniqId }}_media').show();
              $('#cropContainerModal').hide();
            }
        });

        var croppicContainerModalOptions = {
                uploadUrl:'{{ path('img_save_to_file') }}',
                uploadData:{
          				"caption": $('#{{ admin.uniqId }}_caption').val(),
                  "title": $('#{{ admin.uniqId }}_title').val()
                  {% if object.id > 0  %},
                  "article": {{ object.id }}
                  {% endif %}
          			},
                cropUrl:'{{ path('img_crop_to_file') }}',
                {% if object.id > 1 and object.media != '' or object.media != 'c' %}
                    loadPicture:'{{object.media}}',
                    modal:false,
                {% else %}
                    modal:true,
                {% endif %}

                imgEyecandyOpacity:0.4,
                loaderHtml:'<div class="loader bubblingG"><span id="bubblingG_1"></span><span id="bubblingG_2"></span><span id="bubblingG_3"></span></div> ',
                onError:function(errormessage){ console.log('onError:'+errormessage) },
                onAfterImgCrop:function()
                {
                    $('#{{ admin.uniqId }}_media').val(response.url);
                },
                onBeforeImgUpload: function()
                {
                  croppicContainerModalOptions.uploadData.caption = $('#{{ admin.uniqId }}_caption').val();
                }
        }
        var cropContainerModal = new Croppic('cropContainerModal', croppicContainerModalOptions);
        });
       </script>
{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    <link href="{{ asset('bundles/app/css/croppic.css') }}" rel="stylesheet" />
{% endblock %}
